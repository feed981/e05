let createApp=Vue.createApp,notyf=new Notyf({duration:3e3,dismissible:!0}),encryptionService={async encryptData(e){try{var t=(await apiKey.get("/public")).data,r=CryptoJS.lib.WordArray.random(32),a=r.toString(CryptoJS.enc.Hex),s=forge.pki.publicKeyFromPem(t),i=forge.util.encode64(s.encrypt(a)),n=CryptoJS.lib.WordArray.random(16),o=CryptoJS.AES.encrypt(JSON.stringify(e),r,{mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7,iv:n});return{encryptedKey:i,encryptedData:CryptoJS.enc.Base64.stringify(CryptoJS.lib.WordArray.create(n.words.concat(o.ciphertext.words)))}}catch(e){throw console.error("Encryption failed:",e),new Error("加密失敗: "+e.message)}}};createApp({data(){return{isCalendarVisible:!1,isDiaryVisible:!1,username:"",password:"",errorMessage:"",successMessage:"",currentYear:(new Date).getFullYear(),currentMonth:(new Date).getMonth(),selectedDate:"",diaryEntry:"",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],containerHeight:250}},mounted(){},computed:{firstDay(){return new Date(this.currentYear,this.currentMonth,1).getDay()},daysInMonth(){return new Date(this.currentYear,this.currentMonth+1,0).getDate()}},methods:{async checkOrGenerateToken(){if(!localStorage.getItem("token"))try{var e=(await apiAuth.get("/token")).data;localStorage.setItem("token",e)}catch(e){console.error("無法獲取 token:",e)}axios.interceptors.request.use(e=>{var t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer "+t),e})},adjustHeight(){this.$nextTick(()=>{var e=this.$refs.diaryTextarea;this.$refs.diaryTitle,this.$refs.buttonContainer;e.style.height="auto",e.style.height=e.scrollHeight+"px",this.containerHeight=Math.max(250,e.scrollHeight+20)})},clearForm(){this.username="",this.password=""},register(){this.username&&this.password?(localStorage.setItem("diaryUser",this.username),localStorage.setItem("diaryPass",this.password),notyf.success("register success！"),this.clearForm()):notyf.error("register error！")},login(){var e=localStorage.getItem("diaryUser"),t=localStorage.getItem("diaryPass");this.username===e&&this.password===t?(notyf.success("login success！"),this.isCalendarVisible=!0,this.clearForm()):notyf.error("login error！")},logout(){this.isCalendarVisible=!1,this.isDiaryVisible=!1},prevMonth(){this.currentMonth--,this.currentMonth<0&&(this.currentMonth=11,this.currentYear--)},nextMonth(){this.currentMonth++,11<this.currentMonth&&(this.currentMonth=0,this.currentYear++)},prevYear(){this.currentYear--},nextYear(){this.currentYear++},getDateString(e){return`${this.currentYear}-${String(this.currentMonth+1).padStart(2,"0")}-`+String(e).padStart(2,"0")},hasDiaryEntry(e){return null!==localStorage.getItem("diary_"+this.getDateString(e))},openDiary(e){this.selectedDate=e,this.diaryEntry=localStorage.getItem("diary_"+e)||"",this.isDiaryVisible=!0},saveDiary(){this.diaryEntry.trim()?localStorage.setItem("diary_"+this.selectedDate,this.diaryEntry):localStorage.removeItem("diary_"+this.selectedDate),this.isDiaryVisible=!1}}}).mount("#app");